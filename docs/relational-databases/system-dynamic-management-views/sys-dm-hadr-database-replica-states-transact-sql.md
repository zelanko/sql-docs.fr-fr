---
title: sys. dm_hadr_database_replica_states (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/26/2018
ms.prod: sql
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sys.dm_hadr_database_states_TSQL
- sys.dm_hadr_database_states
- dm_hadr_database_states
- dm_hadr_database_states_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- Availability Groups [SQL Server], monitoring
- sys.dm_hadr_database_replica_states dynamic management view
ms.assetid: 1a17b0c9-2535-4f3d-8013-cd0a6d08f773
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 83b3c369add51a853078dd64a8861d633ac330ec
ms.sourcegitcommit: e37636c275002200cf7b1e7f731cec5709473913
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/13/2019
ms.locfileid: "73982278"
---
# <a name="sysdm_hadr_database_replica_states-transact-sql"></a>sys.dm_hadr_database_replica_states (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2012-xxxx-xxxx-xxx-md.md)]

  Retourne une ligne pour chaque base de données qui participe à un groupe de disponibilité Always On pour lequel l’instance locale de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] héberge un réplica de disponibilité. Cette vue de gestion dynamique expose les informations d'état sur les réplicas principaux et secondaires. Sur un réplica secondaire, cette vue retourne une ligne pour chaque base de données secondaire sur l'instance de serveur. Sur le réplica principal, cette vue retourne une ligne pour chaque base de données primaire et une ligne supplémentaire pour la base de données secondaire correspondante.  
  
> [!IMPORTANT]
> Selon l'action et les états de niveau supérieur, les informations d'état de la base de données peuvent être non disponibles ou obsolètes. En outre, les valeurs ont uniquement une pertinence locale. Par exemple, sur le réplica principal, la valeur de la colonne **last_hardened_lsn** reflète les informations relatives à une base de données secondaire donnée qui est actuellement disponible pour le réplica principal, et non la valeur LSN renforcée réelle que le réplica secondaire peut avoir actuellement.  
   
|Nom de la colonne|Type de données|Description (sur le réplica principal)|  
|-----------------|---------------|----------------------------------------|  
|**database_id**|**int**|Identificateur de la base de données, unique dans une instance de SQL Server. Il s’agit de la même valeur que celle affichée dans l’affichage catalogue [sys. databases](../../relational-databases/system-catalog-views/sys-databases-transact-sql.md) .|  
|**group_id**|**uniqueidentifier**|Identificateur du groupe de disponibilité auquel la base de données appartient.|  
|**replica_id**|**uniqueidentifier**|Identificateur du réplica de disponibilité dans le groupe de disponibilité.|  
|**group_database_id**|**uniqueidentifier**|Identificateur de la base de données dans le groupe de disponibilité. Cet identificateur est identique sur chaque réplica auquel cette base de données est attachée.|  
|**is_local**|**bit**|Si la base de données de disponibilité est locale, une des valeurs suivantes :<br /><br /> 0 = La base de données n'est pas locale pour l'instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].<br /><br /> 1 = La base de données est locale pour l'instance de serveur.|  
|**is_primary_replica**|**bit**|Retourne 1 s’il s’agit du réplica principal, ou 0 s'il s'agit d'un réplica secondaire.<br /><br />**S’applique à** : [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] et versions ultérieures.|  
|**synchronization_state**|**tinyint**|État du déplacement des données, l’une des valeurs suivantes.<br /><br /> 0 = pas de synchronisation. Pour une base de données primaire, indique que la base de données n'est pas prête à synchroniser son journal des transactions avec les bases de données secondaires correspondantes. Pour une base de données secondaire, indique que la base de données n'a pas commencé la synchronisation du journal en raison d'un problème de connexion, est suspendue, ou passe par des états de transition pendant le démarrage ou lors d'un changement de rôle.<br /><br /> 1 = synchronisation en cours. Pour une base de données primaire, indique que la base de données est prête à recevoir une demande d'analyse d'une base de données secondaire. Pour une base de données secondaire, indique qu'un déplacement des données actif a lieu pour la base de données.<br /><br /> 2 = synchronisé. Une base de données primaire affiche SYNCHRONIZED à la place de SYNCHRONIZING. Une base de données secondaire avec validation synchrone affiche Synchronisé lorsque le cache local indique que la base de données est prête pour le basculement et que la synchronisation est en cours.<br /><br /> 3 = rétablissement. Indique la phase dans le processus de restauration lorsqu'une base de données secondaire obtient activement les pages de la base de données primaire.<br />**Attention :** Lorsqu’une base de données sur un réplica secondaire se trouve dans l’État Reverting, forcer le basculement vers le réplica secondaire laisse la base de données dans un État dans lequel elle ne peut pas être démarrée en tant que base de données primaire. La base de données doit se reconnecter comme base de données secondaire, ou vous devez appliquer les nouveaux enregistrements du journal à partir d'une sauvegarde du journal.<br /><br /> 4 = initialisation en cours. Indique la phase de restauration lorsque le journal des transactions requis pour qu'une base de données secondaire rattrape le retard du numéro séquentiel de restauration dans le journal est livré et renforcé sur un réplica secondaire.<br />**Attention :** Lorsqu’une base de données sur un réplica secondaire se trouve dans l’état initialisation, forcer le basculement vers le réplica secondaire laisse la base de données dans un État dans lequel elle ne peut pas être démarrée en tant que base de données primaire. La base de données doit se reconnecter comme base de données secondaire, ou vous devez appliquer les nouveaux enregistrements du journal à partir d'une sauvegarde du journal.|  
|**synchronization_state_desc**|**nvarchar(60)**|Description de l'état de déplacement des données, un des suivants :<br /><br /> NOT SYNCHRONIZING<br /><br /> SYNCHRONIZING<br /><br /> SYNCHRONIZED<br /><br /> REVERTING<br /><br /> INITIALIZING|  
|**is_commit_participant**|**bit**|0 = La validation de transaction n'est pas synchronisée par rapport à cette base de données.<br /><br /> 1 = La validation de transaction est synchronisée par rapport à cette base de données.<br /><br /> Pour une base de données sur un réplica de disponibilité avec validation asynchrone, cette valeur est toujours de 0.<br /><br /> Pour une base de données sur un réplica de disponibilité avec validation synchrone, cette valeur est exacte uniquement sur la base de données primaire.|  
|**synchronization_health**|**tinyint**|Reflète l’intersection de l’état de synchronisation d’une base de données jointe au groupe de disponibilité sur le réplica de disponibilité et le mode de disponibilité du réplica de disponibilité (mode de validation synchrone ou asynchrone), l’un des valeurs suivantes.<br /><br /> 0 = non intègre. La **synchronization_state** de la base de données est 0 (pas la synchronisation).<br /><br /> 1 = intégrité partielle. Une base de données sur un réplica de disponibilité avec validation synchrone est considérée comme partiellement intègre si **synchronization_state** est 1 (synchronisation).<br /><br /> 2 = sain. Une base de données sur un réplica de disponibilité avec validation synchrone est considérée comme saine si **synchronization_state** est 2 (synchronisée) et qu’une base de données sur un réplica de disponibilité avec validation asynchrone est considérée comme saine si **synchronization_state** est de 1 (synchronisation).|  
|**synchronization_health_desc**|**nvarchar(60)**|Description de la **synchronization_health** de la base de données de disponibilité.<br /><br /> NOT_HEALTHY<br /><br /> PARTIALLY_HEALTHY<br /><br /> HEALTHY|  
|**database_state**|**tinyint**|0 = En ligne<br /><br /> 1 = Restauration<br /><br /> 2 = Récupération<br /><br /> 3 = Récupération en attente<br /><br /> 4 = Suspect<br /><br /> 5 = Urgence<br /><br /> 6 = Hors connexion<br /><br /> **Remarque :** Identique à la colonne **State** dans sys. databases.|  
|**database_state_desc**|**nvarchar(60)**|Description de la **database_state** du réplica de disponibilité.<br /><br /> ONLINE<br /><br /> RESTORING<br /><br /> RECOVERING<br /><br /> RECOVERY_PENDING<br /><br /> SUSPECT<br /><br /> EMERGENCY<br /><br /> OFFLINE<br /><br /> **Remarque :** Identique à **state_desc** colonne dans sys. databases.|  
|**is_suspended**|**bit**|État de la base de données, un des suivants :<br /><br /> 0 = Reprise<br /><br /> 1 = Suspendu|  
|**suspend_reason**|**tinyint**|Si la base de données est suspendue, la raison de l'état suspendu, une des suivantes :<br /><br /> 0 = Action de l'utilisateur<br /><br /> 1 = Interruption du partenaire<br /><br /> 2 = Rétablir<br /><br /> 3 = Capturer<br /><br /> 4 = Appliquer<br /><br /> 5 = Redémarrer<br /><br /> 6 = Annuler<br /><br /> 7 = Revalidation<br /><br /> 8 = Erreur dans le calcul du point de synchronisation du réplica secondaire|  
|**suspend_reason_desc**|**nvarchar(60)**|Description de la raison de l'état d'interruption, une des suivantes :<br /><br /> SUSPEND_FROM_USER = Déplacement des données suspendu manuellement par un utilisateur.<br /><br /> SUSPEND_FROM_PARTNER = Le réplica de base de données est interrompu après un basculement forcé<br /><br /> SUSPEND_FROM_REDO = Une erreur s'est produite pendant la phase de restauration par progression<br /><br /> SUSPEND_FROM_APPLY = Une erreur s'est produite lors de l'écriture du journal dans le fichier (voir le journal des erreurs)<br /><br /> SUSPEND_FROM_CAPTURE = une erreur s'est produite lors de la capture du journal sur le réplica principal<br /><br /> SUSPEND_FROM_RESTART = Le réplica de base de données a été suspendu avant le redémarrage de la base de données (voir le journal des erreurs)<br /><br /> SUSPEND_FROM_UNDO = Une erreur s'est produite pendant la phase de restauration (voir le journal des erreurs)<br /><br /> SUSPEND_FROM_REVALIDATION = Incompatibilité de modification du journal détectée lors de la reconnexion (voir le journal des erreurs)<br /><br /> SUSPEND_FROM_XRF_UPDATE = Impossible de trouver le point de journal commun (voir le journal des erreurs)|  
|**recovery_lsn**|**numeric(25,0)**|Sur le réplica principal, la fin du journal des transactions avant que la base de données primaire n'écrive de nouveaux enregistrements de journal après la récupération ou le basculement. Pour une base de données secondaire donnée, si cette valeur est inférieure au numéro séquentiel dans le journal (NSE) renforcé actuel (last_hardened_lsn), recovery_lsn est la valeur à laquelle cette base de données secondaire doit être resynchronisée (c'est-à-dire, rétablie et réinitialisée). Si cette valeur est supérieure ou égale au numéro séquentiel dans le journal renforcé actuel, la resynchronisation n'est pas nécessaire et ne se produira pas.<br /><br /> **recovery_lsn** reflète un ID de bloc de journal complété avec des zéros. Il ne s'agit pas d'un numéro séquentiel réel dans le journal (LSN). Pour plus d’informations sur la façon dont cette valeur est dérivée, consultez [Présentation des valeurs de colonne LSN](#LSNcolumns), plus loin dans cette rubrique.|  
|**truncation_lsn**|**numeric(25,0)**|Sur le réplica principal pour la base de données primaire, reflète la valeur minimale de LSN de troncation de journal sur toutes les bases de données secondaires correspondantes. Si la troncation du journal en local est bloquée (notamment par une opération de sauvegarde), ce LSN peut être supérieur au LSN de troncation en local.<br /><br /> Pour une base de données secondaire donnée, reflète le point de troncation de cette base de données.<br /><br /> **truncation_lsn** reflète un ID de bloc de journal complété avec des zéros. Il ne s'agit pas d'un numéro séquentiel réel dans le journal.|  
|**last_sent_lsn**|**numeric(25,0)**|Identificateur du bloc du journal qui indique le point jusqu'auquel tous les blocs du journal ont été envoyés par la base de données primaire. ID du bloc suivant de journal qui sera envoyé, plutôt que l'ID du bloc de journal le plus récemment envoyé.<br /><br /> **last_sent_lsn** reflète un ID de bloc de journal complété avec des zéros, il ne s’agit pas d’un numéro séquentiel dans le journal réel.|  
|**last_sent_time**|**datetime**|Heure à laquelle le dernier bloc du journal a été envoyé.|  
|**last_received_lsn**|**numeric(25,0)**|ID de bloc du journal qui identifie le point jusqu'auquel tous les blocs du journal ont été reçus par le réplica secondaire qui héberge cette base de données secondaire.<br /><br /> **last_received_lsn** reflète un ID de bloc de journal complété avec des zéros. Il ne s'agit pas d'un numéro séquentiel réel dans le journal.|  
|**last_received_time**|**datetime**|Heure à laquelle l'ID de bloc de journal du dernier message reçu a été lu sur le réplica secondaire.|  
|**last_hardened_lsn**|**numeric(25,0)**|Début du bloc de journal contenant les enregistrements de journal du LSN de dernière sécurisation renforcée sur une base de données secondaire.<br /><br /> Sur une base de données primaire avec validation asynchrone ou sur une base de données avec validation synchrone dont la stratégie actuelle est « delay », la valeur est NULL. Pour les autres bases de données primaires avec validation synchrone, **last_hardened_lsn** indique la valeur minimale du LSN renforcé sur toutes les bases de données secondaires.<br /><br /> **Remarque : last_hardened_lsn** reflète un ID de bloc de journal complété avec des zéros. Il ne s'agit pas d'un numéro séquentiel réel dans le journal. Pour plus d’informations, voir [Understanding the LSN Column Values](#LSNcolumns), plus loin dans cette rubrique.|  
|**last_hardened_time**|**datetime**|Sur une base de données secondaire, heure de l’identificateur de bloc de journal pour le dernier LSN renforcé (**last_hardened_lsn**). Sur une base de données primaire, reflète l'heure correspondant à la valeur minimale de LSN renforcé.|  
|**last_redone_lsn**|**numeric(25,0)**|Numéro séquentiel dans le journal réel du dernier enregistrement du journal qui a été restauré sur la base de données secondaire. **last_redone_lsn** est toujours inférieur à **last_hardened_lsn**.|  
|**last_redone_time**|**datetime**|Heure à laquelle le dernier enregistrement du journal a été restauré sur la base de données secondaire.|  
|**log_send_queue_size**|**bigint**|Quantité d'enregistrements du journal dans la base de données primaire, en kilo-octets (Ko), qui n'a pas encore été envoyée aux bases de données secondaires.|  
|**log_send_rate**|**bigint**|Vitesse moyenne à laquelle l’instance de réplica principal a envoyé des données au cours de la dernière période active, en kilo-octets (Ko)/seconde.|  
|**redo_queue_size**|**bigint**|Quantité d'enregistrements du journal dans les fichiers journaux du réplica secondaire qui n'a pas encore été réexécutée, en kilo-octets (Ko).|  
|**redo_rate**|**bigint**|Vitesse moyenne à laquelle les enregistrements de journal sont réexécutés sur une base de données secondaire donnée, en kilo-octets (Ko)/seconde.|  
|**filestream_send_rate**|**bigint**|Fréquence à laquelle les fichiers FILESTREAM sont envoyés sur le réplica secondaire en kilo-octets/seconde.|  
|**end_of_log_lsn**|**numeric(25,0)**|LSN de fin de journal local. Numéro séquentiel réel dans le journal correspondant au dernier enregistrement du journal dans le cache du journal sur les bases de données primaire et secondaire. Sur le réplica principal, les lignes secondaires reflètent le LSN de fin de journal, depuis les derniers messages de progression que les réplicas secondaires ont envoyés au réplica principal.<br /><br /> **end_of_log_lsn** reflète un ID de bloc de journal complété avec des zéros. Il ne s'agit pas d'un numéro séquentiel réel dans le journal. Pour plus d’informations, voir [Understanding the LSN Column Values](#LSNcolumns), plus loin dans cette rubrique.|  
|**last_commit_lsn**|**Numeric(25,0)**|Numéro séquentiel réel dans le journal correspondant au dernier enregistrement de validation dans le journal des transactions.<br /><br /> Sur la base de données primaire, cet argument correspond au dernier enregistrement de validation traité. Les lignes des bases de données secondaires indiquent le numéro séquentiel dans le journal que le réplica secondaire a envoyé au réplica principal.<br /><br /> Sur le réplica secondaire, il s'agit du dernier enregistrement de validation qui a été restauré.|  
|**last_commit_time**|**datetime**|Heure correspondant au dernier enregistrement de validation.<br /><br /> Sur la base de données secondaire, cette heure est la même que dans la base de données primaire.<br /><br /> Sur le réplica principal, chaque ligne de base de données secondaire indique l'heure que le réplica secondaire qui héberge la base de données secondaire a signalé au réplica principal. La différence de temps entre la ligne de base de données primaire et une ligne de base de données secondaire donnée représente approximativement l’objectif de point de récupération (RPO), en supposant que le processus de rétablissement est pris en compte et que la progression a été signalée au réplica principal. par le réplica secondaire.|  
|**low_water_mark_for_ghosts**|**bigint**|Nombre à croissance monotone pour la base de données, qui indique une limite inférieure utilisée par la tâche de nettoyage des enregistrements fantômes sur la base de données primaire. Si ce nombre n'augmente pas avec le temps, cela implique que le nettoyage des enregistrements fantômes ne se produit pas. Pour déterminer quelles lignes fantômes nettoyer, le réplica principal utilise la valeur minimale de cette colonne pour cette base de données sur tous les réplicas de disponibilité (y compris le réplica principal).|  
|**secondary_lag_seconds**|**bigint**|Nombre de secondes pendant lesquelles le réplica secondaire est derrière le réplica principal au cours de la synchronisation.<br /><br />**S’applique à** : [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] et versions ultérieures.|  
  
##  <a name="LSNcolumns"></a>Fonctionnement des valeurs de colonne LSN  
 Les valeurs des colonnes **end_of_log_lsn**, **last_hardened_lsn**, **last_received_lsn**, **last_sent_lsn**, **recovery_lsn**et **truncation_lsn** ne sont pas des numéros séquentiels dans le journal (LSN) réels. Chacune de ces valeurs reflète plutôt un ID de bloc de journal complété avec des zéros.  
  
 **end_of_log_lsn**, **last_hardened_lsn**et **recovery_lsn** sont LSN. Par exemple, **last_hardened_lsn** indique le début du bloc suivant après les blocs qui sont déjà sur le disque.  Par conséquent, tout LSN < la valeur de **last_hardened_lsn** se trouve sur le disque.  Le LSN > = à cette valeur n’est pas vidé.  
  
 Parmi les valeurs LSN retournées par **sys. dm_hadr_database_replica_states**, seul **LAST_REDONE_LSN** est un LSN réel.  
  
## <a name="security"></a>Sécurité  
  
### <a name="permissions"></a>Autorisations  
 requièrent l'autorisation VIEW SERVER STATE sur le serveur.  
  
## <a name="see-also"></a>Voir aussi  
 [Groupes de disponibilité Always On &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)   
 [Surveiller des groupes de disponibilité &#40;Transact-SQL&#41;](../../database-engine/availability-groups/windows/monitor-availability-groups-transact-sql.md)  
  
  
